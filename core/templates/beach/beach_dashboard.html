{% extends 'base.html' %}

{% block title %}Collector Dashboard{% endblock %}

{% load static %}

{% load humanize %}

{% block content %}
<div class="flex h-screen">
    {% include 'beach/beach_sidebar.html' %}
    
    <div class="flex-1 overflow-y-auto p-6 sm:ml-64">
        <h1 class="text-2xl font-semibold mb-4">{{ collector.nickname|default:"Collector" }} Dashboard</h1>

        <a href="{% url 'generate_pdf_report' %}" style="background: blue; color: white; padding: 10px; display: block; text-align: center; margin-top: 20px;">
            Download PDF Report
        </a>
        

        <!-- Summary Metrics -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <div class="bg-white p-4 shadow rounded text-center">
                <h3 class="text-gray-600 text-sm">Total Reservations</h3>
                <p class="text-xl font-bold text-green-600">{{ total_reservations|default:"0" }}</p>
            </div>
            <div class="bg-white p-4 shadow rounded text-center">
                <h3 class="text-gray-600 text-sm">Approved Reservations</h3>
                <p class="text-xl font-bold text-blue-600">{{ approved_reservations|default:"0" }}</p>
            </div>
            <div class="bg-white p-4 shadow rounded text-center">
                <h3 class="text-gray-600 text-sm">Pending Payments</h3>
                <p class="text-xl font-bold text-yellow-500">{{ pending_payments|default:"0" }}</p>
            </div>
            <div class="bg-white p-4 shadow rounded text-center">
                <h3 class="text-gray-600 text-sm">Earnings Today</h3>
                <p class="text-xl font-bold text-green-600">â‚±{{ total_earnings_today|floatformat:2|intcomma|default:"0.00" }}</p>
            </div>
        </div>

        <!-- Reservations and Payments Section -->
        <div class="grid grid-cols-1 sm:grid-cols-1 gap-6">
            <!-- Reservations Section -->
            <div class="bg-white p-6 rounded shadow mt-6">
                <h2 class="text-xl text-blue-700 font-bold mb-4">Reservations for {{ collector.beach.name }}</h2>
        
                {% if reservations %}
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white table-auto text-sm">
                        <thead>
                            <tr>
                                <th class="p-4 text-left">Tourist</th>
                                <th class="p-4 text-left">Date</th>
                                <th class="p-4 text-left">People</th>
                                <th class="p-4 text-left">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reservation in reservations %}
                            <tr>
                                <td class="p-4">
                                    {% if reservation.tourist.nickname %}
                                        {{ reservation.tourist.nickname }}
                                    {% else %}
                                        {% if reservation.approved %}
                                            {{ reservation.approved_by.nickname|default:"No Nickname" }}
                                        {% else %}
                                            No Nickname
                                        {% endif %}
                                    {% endif %}
                                </td>
                                <td class="p-4">{{ reservation.date_reserved }}</td>
                                <td class="p-4">{{ reservation.num_people }}</td>
                                <td class="p-4">
                                    {% if reservation.approved %}
                                    <span class="text-green-500">Approved</span>
                                    {% else %}
                                    <span class="text-yellow-500">Pending</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p>No reservations yet.</p>
                {% endif %}
            </div>

            <!-- Payments Section -->
            <div class="bg-white p-6 rounded shadow mt-6">
                <h2 class="text-xl text-blue-700 font-bold mb-4">Payment Status for {{ collector.beach.name }}</h2>
        
                {% if payments %}
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white table-auto text-sm">
                        <thead>
                            <tr>
                                <th class="p-4 text-left">Reservation</th>
                                <th class="p-4 text-left">Amount</th>
                                <th class="p-4 text-left">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for payment in payments %}
                                {% if payment.status == 'paid' %}
                                <tr>
                                    <td class="p-4">{{ payment.reservation.date_reserved }}</td>
                                    <td class="p-4">{{ payment.amount|intcomma }}</td>
                                    <td class="p-4"><span class="text-green-500">Paid</span></td>
                                </tr>
                                {% endif %}
                            {% endfor %}

                        </tbody>
                    </table>
                </div>
                {% else %}
                <p>No payments recorded.</p>
                {% endif %}
            </div>
            
        </div>
    </div>
    
    
</div>
{% endblock %}
